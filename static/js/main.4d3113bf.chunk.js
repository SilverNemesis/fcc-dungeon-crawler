(this["webpackJsonpfcc-dungeon-crawler"]=this["webpackJsonpfcc-dungeon-crawler"]||[]).push([[0],{14:function(e,t,n){},15:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(3),i=n.n(r),h=(n(14),n(4)),l=n(5),s=n(7),c=n(6),m=n(1),u=n(8),d=function(e){var t=e.control;return o.a.createElement("div",{className:"control"},t.description)},f=function(e){for(var t=e.control,n=[],a=0;a<t.options.length;a++)n.push(o.a.createElement("option",{key:a,value:a},t.options[a]));return o.a.createElement("div",{className:"control"},o.a.createElement("label",{htmlFor:t.name},t.name),o.a.createElement("select",{id:t.name,className:"select-css",value:t.value,onChange:function(n){e.onChange(t,n.target.value)}},n))},v=function(e){var t=e.control;return o.a.createElement("div",{className:"control"},o.a.createElement("label",{className:"clickable",htmlFor:t.name},o.a.createElement("input",{className:"clickable",id:t.name,type:"checkbox",checked:t.value,onChange:function(n){e.onChange(t,n.target.checked)}}),t.name))},y=function(e){var t=e.control;return o.a.createElement("div",{className:"control"},o.a.createElement("label",{htmlFor:t.name},t.name," ",t.value),o.a.createElement("input",{id:t.name,className:"clickable",type:"range",min:t.min,max:t.max,value:t.value,onChange:function(n){e.onChange(t,Number(n.target.value))}}))},g=function(e){var t=e.control;return o.a.createElement("div",{className:"control"},o.a.createElement("label",{htmlFor:t.name},t.name," ",t.value.toFixed(3)),o.a.createElement("input",{id:t.name,className:"clickable",type:"range",min:Math.floor(1e3*t.min),max:Math.floor(1e3*t.max),value:Math.floor(1e3*t.value),onChange:function(n){e.onChange(t,Number(n.target.value)/1e3)}}))},x=function(e){var t=e.control;return o.a.createElement("div",{className:"control"},o.a.createElement("button",{onClick:function(e){t.function()}},t.name))},p=function(e){var t,n=e.show,a=e.title,r=e.onClickPrevious,i=e.onClickNext,h=e.onChange,l=e.options;return n?(l&&(t=l.map((function(e,t){switch(e.type){case"description":return o.a.createElement(d,{key:t,control:e});case"select":return o.a.createElement(f,{key:t,control:e,onChange:h});case"bool":return o.a.createElement(v,{key:t,control:e,onChange:h});case"int":return o.a.createElement(y,{key:t,control:e,onChange:h});case"float":return o.a.createElement(g,{key:t,control:e,onChange:h});case"function":return o.a.createElement(x,{key:t,control:e});default:return o.a.createElement("div",{key:t,className:"control"},e.type," is not supported")}}))),o.a.createElement("div",{id:"controls"},o.a.createElement("div",{className:"none"},o.a.createElement("span",{className:"left",onClick:r},"\u276e PREV"),o.a.createElement("span",{className:"right",onClick:i},"NEXT \u276f"),o.a.createElement("div",{className:"center title"},a)),o.a.createElement("div",null,t))):null},w=[{x:0,y:-1},{x:1,y:0},{x:0,y:1},{x:-1,y:0}];function k(e){for(var t=e.width,n=e.height,a=e.zones,o=e.bossRoom,r=[],i=0;i<n;i++)r.push(new Array(t).fill(0));var h={width:t,height:n,data:r},l=function(e,t){var n=e.width,a=e.height,o=t.goal,r=t.minSize,i=t.maxSize;o||(o=.5);r||(r=3);i||(i=Math.max(Math.floor(Math.min(n/4,a/4)),r));for(var h=[],l=0,s=i;s>=r;s--)for(var c=Math.pow(2,l++),m=0;m<c;m++)h.push(s);var u=[],d=n*a*o,f=0;for(;f<d;){var v=z(h),y={width:v,height:v};Math.random()>.3&&(Math.random()<.5?y.width+=2:y.height+=2),u.push(y),f+=y.width*y.height}return e.rooms=u,Math.floor(n*a*Math.min(1.5*o,1))}(h,e);h.rooms.sort((function(e,t){var n=e.width*e.height,a=t.width*t.height;return n<a?1:n>a?-1:0}));var s=e.maxRooms;if(0===s&&(s=void 0),a&&a>1){if(function(e,t,n){for(var a=e.width,o=e.height,r=[],i=0;i<t;i++)r[i]=i;!function(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*(t+1)),a=e[t];e[t]=e[n],e[n]=a}}(r);for(var h=Math.floor((a-2)/t),l=Math.floor((o-2)/t),s=[],c=0;c<t;c++){var m={x:c*h+1,y:r[c]*l+1,width:h,height:l};s.push(m)}for(var u=0,d=0;d<t;d++){var f=s[d];u+=f.width*f.height}var v=!0;for(;u<n&&v;){v=!1;for(var y=0;y<t;y++){var g=[],x=s[y];if(x.y>1&&M(x.x,x.y-1,x.width,x.height+1,y,s)&&g.push("up"),x.y+x.height<o-2&&M(x.x,x.y,x.width,x.height+1,y,s)&&g.push("down"),x.x>1&&M(x.x-1,x.y,x.width+1,x.height,y,s)&&g.push("left"),x.x+x.width<a-2&&M(x.x,x.y,x.width+1,x.height,y,s)&&g.push("right"),g.length>0)switch(v=!0,z(g)){case"up":x.y--,x.height++,u+=x.width;break;case"down":x.height++,u+=x.width;break;case"left":x.x--,x.width++,u+=x.height;break;case"right":x.width++,u+=x.height}}}e.zones=s}(h,a,l),o){var c=h.rooms[0],m=h.zones[0];c.width<=m.width&&c.height<=m.height&&(c.x=Math.floor(m.x),c.y=Math.floor(m.y+(m.height-c.height)/2),c.zone=1,void 0!==s&&s--)}var u=function(e,t){for(var n=e.rooms,a=e.zones,o=0,r=0;r<a.length;r++)for(var i=0,h=a[r],l=n.length,s=0;s<l&&(void 0===t||!(o>=t||i>=Math.floor(t/a.length)));s++){var c=n[s];if(!c.hasOwnProperty("x")||!c.hasOwnProperty("y")){var m=h.x,u=h.x+h.width-c.width,d=h.y,f=h.y+h.height-c.height;if(!(u<m||f<d)){for(var v=!1,y=0;y<100;y++){c.x=E(m,u),c.y=E(d,f);for(var g=!1,x=0;x<l;x++)if(x!==s&&n[x].hasOwnProperty("x")&&n[x].hasOwnProperty("y")&&O(c,n[x],1,1)){g=!0;break}if(!g){v=!0;break}}v?(c.zone=r+1,i++,o++):(delete c.x,delete c.y)}}}return o}(h,s);void 0!==s&&(s-=u)}else if(o){var d=h.rooms[0];d.width<=t-2&&d.height<=n-2&&(d.x=Math.floor((t-d.width)/2),d.y=Math.floor((n-d.height)/2),void 0!==s&&s--)}return function(e,t){for(var n=e.width,a=e.height,o=e.rooms,r=0,i=o.length,h=0;h<i&&(void 0===t||r!==t);h++){var l=o[h];if(!l.hasOwnProperty("x")||!l.hasOwnProperty("y")){for(var s=!1,c=0;c<1e3;c++){l.x=E(1,n-l.width-1),l.y=E(1,a-l.height-1);for(var m=!1,u=0;u<i;u++)if(u!==h&&o[u].hasOwnProperty("x")&&o[u].hasOwnProperty("y")&&O(l,o[u],l.width>=7?3:1,l.height>=7?3:1)){m=!0;break}if(!m){s=!0;break}}s?r++:(delete l.x,delete l.y)}}e.rooms=e.rooms.filter((function(e){return e.x||e.y})),e.rooms.length}(h,s),function(e){for(var t=e.data,n=e.rooms,a=n.length,o=0;o<a;o++){var r=n[o];r.id=o+1;for(var i=0;i<r.height;i++)for(var h=0;h<r.width;h++)t[r.y+i][r.x+h]=r.id}}(h),function(e){var t=e.data,n=e.rooms,a=b(n.length),o=function(e){for(var t=e.width,n=e.height,a=e.data,o=[],r=1;r<n-1;r++)for(var i=1;i<t-1;i++)0===a[r][i]&&(0===a[r-1][i]&&0===a[r+1][i]&&0!==a[r][i-1]&&0!==a[r][i+1]?a[r][i-1]<a[r][i+1]?o.push({x:i,y:r,r1:a[r][i-1],r2:a[r][i+1]}):a[r][i-1]>a[r][i+1]&&o.push({x:i,y:r,r1:a[r][i+1],r2:a[r][i-1]}):0===a[r][i-1]&&0===a[r][i+1]&&0!==a[r-1][i]&&0!==a[r+1][i]&&(a[r-1][i]<a[r+1][i]?o.push({x:i,y:r,r1:a[r-1][i],r2:a[r+1][i]}):a[r-1][i]>a[r+1][i]&&o.push({x:i,y:r,r1:a[r+1][i],r2:a[r-1][i]})));return o}(e);r=o,r.sort((function(e,t){return e.r1<t.r1?-1:e.r1>t.r1?1:e.r2<t.r2?-1:e.r2>t.r2?1:e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}));var r;var i,h,l=n.length,s=l+1,c=o.length;for(i=0;i<c;i=h){for(h=i+1;h<c&&(o[h].r1===o[i].r1&&o[h].r2===o[i].r2);h++);if(a[o[i].r1]!==a[o[i].r2]){var m=o[Math.floor(i+(h-i)/2)],u=Math.min(a[m.r1],a[m.r2]),d=Math.max(a[m.r1],a[m.r2]);a[m.r1]=u,a[m.r2]=u;for(var f=1;f<=l;f++)a[f]===d&&(a[f]=u);t[m.y][m.x]=s}}for(var v=0;v<l;v++){var y=n[v];y.group=a[y.id]}e.connected=C(a)}(h),function(e){var t=e.data,n=e.rooms;!function(e){e.sort((function(e,t){return e.group<t.group?-1:e.group>t.group?1:e.id<t.id?-1:e.id>t.id?1:0}))}(n);var a=function(e){var t,n,a=e.length,o=0;for(t=0;t<a;t=n){for(n=t+1;n<a&&e[n].group===e[t].group;n++);o++;for(var r=t;r<n;r++)e[r].group=o}return o}(n);if(1===a)return;var o=function(e){for(var t=e.length,n={},a=0;a<t;a++)for(var o=a+1;o<t;o++)if(e[a].group!==e[o].group){var r=S(e[a],e[o]);if(r){var i=r.alignment,h=r.distance,l=r.x,s=r.y,c=r.horizontal;if(0!==i){var m=e[a].group,u=e[o].group,d=m+"_"+u;n[d]?(n[d].distance>h||n[d].distance===h&&n[d].alignment<r)&&(n[d]={distance:h,g1:m,g2:u,room1:e[a].id,room2:e[o].id,alignment:i,x:l,y:s,horizontal:c}):n[d]={distance:h,g1:m,g2:u,room1:e[a].id,room2:e[o].id,alignment:i,x:l,y:s,horizontal:c}}}}var f=[];for(var v in n)n.hasOwnProperty(v)&&f.push(n[v]);return f}(n);r=o,r.sort((function(e,t){return e.distance<t.distance?-1:e.distance>t.distance?1:e.alignment<t.alignment?-1:e.alignment>t.alignment?1:0}));var r;for(var i=b(a),h=n.length+1,l=0;l<o.length;l++){var s=o[l];if(i[s.g1]!==i[s.g2]){var c=Math.min(i[s.g1],i[s.g2]),m=Math.max(i[s.g1],i[s.g2]);i[s.g1]=c,i[s.g2]=c;for(var u=1;u<=a;u++)i[u]===m&&(i[u]=c);var d=s.x,f=s.y,v=s.distance;if(s.horizontal)for(var y=0;y<v;y++)t[f][d+y]=h;else for(var g=0;g<v;g++)t[f+g][d]=h}}e.connected=C(i)}(h),function(e){e.sort((function(e,t){return e.id<t.id?-1:e.id>t.id?1:0}))}(h.rooms),h}function M(e,t,n,a,o,r){for(var i=0;i<r.length;i++)if(i!==o&&F(e,t,n,a,r[i]))return!1;return!0}function F(e,t,n,a,o){return!(e>=o.x+o.width||o.x>=e+n)&&!(t>=o.y+o.height||o.y>=t+a)}function b(e){for(var t=[],n=0;n<=e;n++)t.push(n);return t}function C(e){for(var t=1;t<e.length;t++)if(1!==e[t])return!1;return!0}function E(e,t){return Math.floor(Math.random()*(t-e+1))+e}function z(e){return e[Math.floor(Math.random()*e.length)]}function O(e,t,n,a){return!(e.x>=t.x+t.width+n||t.x>=e.x+e.width+n)&&!(e.y>=t.y+t.height+a||t.y>=e.y+e.height+a)}function S(e,t){if(e.y>t.y+t.height||t.y>e.y+e.height){if(e.x>t.x+t.width||t.x>e.x+e.width)return null;var n,a;e.y>t.y+t.height?(n=t.y+t.height,a=e.y-n):(n=e.y+e.height,a=t.y-n);var o=Math.min(e.x+e.width,t.x+t.width),r=Math.max(e.x,t.x);return{alignment:o-r,distance:a,x:Math.floor((r+o)/2),y:n,horizontal:!1}}if(e.x>t.x+t.width||t.x>e.x+e.width){var i,h;e.x>t.x+t.width?(i=t.x+t.width,h=e.x-i):(i=e.x+e.width,h=t.x-i);var l=Math.min(e.y+e.height,t.y+t.height),s=Math.max(e.y,t.y);return{alignment:l-s,distance:h,x:i,y:Math.floor((s+l)/2),horizontal:!0}}return null}function N(e){var t=e.getBoundingClientRect();e.width=t.width,e.height=t.height}var R=function(e){function t(e){var n;Object(h.a)(this,t),(n=Object(s.a)(this,Object(c.a)(t).call(this,e))).onResize=n.onResize.bind(Object(m.a)(n)),n.onKeyDown=n.onKeyDown.bind(Object(m.a)(n)),n.onKeyUp=n.onKeyUp.bind(Object(m.a)(n)),n.onAnimationFrame=n.onAnimationFrame.bind(Object(m.a)(n)),n.onClickPrevious=n.onClickPrevious.bind(Object(m.a)(n)),n.onClickNext=n.onClickNext.bind(Object(m.a)(n)),n.onChange=n.onChange.bind(Object(m.a)(n)),n.updateMap=n.updateMap.bind(Object(m.a)(n)),n.keys={};var a={width:112,height:63,goal:.25,zones:6,minSize:4,maxSize:12,maxRooms:30,bossRoom:!0};return n.state={showControls:!1,mode:0,modes:["Map Mode","Explore Mode"],mapOptions:a,options:[[{name:"Update Map",type:"function",function:n.updateMap},{name:"Map Width",type:"int",id:"width",min:10,max:200,value:a.width},{name:"Map Height",type:"int",id:"height",min:10,max:100,value:a.height},{name:"Room Fraction",type:"float",id:"goal",min:0,max:1,value:a.goal},{name:"Min Room Size",type:"int",id:"minSize",min:2,max:8,value:a.minSize},{name:"Max Room Size",type:"int",id:"maxSize",min:8,max:14,value:a.maxSize},{name:"Max Rooms",type:"int",id:"maxRooms",min:0,max:100,value:a.maxRooms},{name:"Zones",type:"int",id:"zones",min:0,max:20,value:a.zones},{name:"Boss Room",type:"bool",id:"bossRoom",value:a.bossRoom}],[]]},n}return Object(u.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){N(this.canvas),this.updateMap(),window.addEventListener("resize",this.onResize),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.frame=window.requestAnimationFrame(this.onAnimationFrame)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.onResize),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp),window.cancelAnimationFrame(this.frame)}},{key:"onResize",value:function(){N(this.canvas)}},{key:"onKeyDown",value:function(e){e.preventDefault(),this.keys[e.key]||(this.onKeyPress(e.key),this.keys[e.key]=!0,this.captureKeys&&this.state.scene.keyboardState(this.keys))}},{key:"onKeyUp",value:function(e){e.preventDefault(),this.keys[e.key]=!1,this.captureKeys&&this.state.scene.keyboardState(this.keys)}},{key:"onKeyPress",value:function(e){var t=this.state,n=t.map,a=t.player;"Escape"===e&&this.setState({showControls:!this.state.showControls});var o=0,r=0;"ArrowUp"===e?r=-1:"ArrowDown"===e?r=1:"ArrowLeft"===e?o=-1:"ArrowRight"===e&&(o=1),0===o&&0===r||0!==n.data[a.y+r][a.x+o]&&this.setState({player:{x:a.x+o,y:a.y+r}})}},{key:"onCloseMenu",value:function(){this.setState({showControls:!1})}},{key:"onAnimationFrame",value:function(){this.state&&this.state.map&&function(e,t,n){var a=t.width,o=t.height,r=t.data,i=t.rooms,h=t.zones,l=e.getContext("2d");l.fillStyle="#000000",l.fillRect(0,0,e.width,e.height);var s=Math.floor(e.width/a),c=Math.floor(e.height/o),m=Math.floor((e.width-a*s)/2),u=Math.floor((e.height-o*c)/2),d=["#7F0000","#007F00","#00007F","#7F7F00","#7F007F","#007F7F","#7F3F3F","#3F7F3F","#3F3F7F","#7F7F3F","#7F3F7F","#3F7F7F"];if(h)for(var f=0;f<h.length;f++){var v=h[f];l.fillStyle=d[f%d.length];for(var y=0;y<v.height;y++)for(var g=0;g<v.width;g++)l.fillRect(m+(v.x+g)*s+Math.floor((s-4)/2),u+(v.y+y)*c+Math.floor((c-4)/2),4,4)}for(var x=0;x<o;x++)for(var p=0;p<a;p++)if(0!==r[x][p]){var w=void 0;r[x][p]<=i.length&&(w=i[r[x][p]-1]).group?l.fillStyle=d[(w.group-1)%d.length]:l.fillStyle="#3F3F3F",l.fillRect(m+p*s+1,u+x*c+1,s-2,c-2),l.fillStyle="#FFFFFF",l.font="8px monospace",l.textAlign="center",l.textBaseline="middle",w&&w.zone?(l.fillText(r[x][p].toString(),m+p*s+s/2,u+x*c+c/4),l.fillText(w.zone.toString(),m+p*s+s/2,u+x*c+3*c/4)):l.fillText(r[x][p].toString(),m+p*s+s/2,u+x*c+c/2)}var k=Math.floor(i[0].x+i[0].width/2),M=Math.floor(i[0].y+i[0].height/2);l.fillStyle="#FFFFFF",l.font="50px monospace",l.textAlign="center",l.textBaseline="middle",l.fillText("O",m+k*s+s/2,u+M*c+c/2),l.fillStyle="#FFFFFF",l.font="50px monospace",l.textAlign="center",l.textBaseline="middle",l.fillText("X",m+n.x*s+s/2,u+n.y*c+c/2)}(this.canvas,this.state.map,this.state.player),this.frame=window.requestAnimationFrame(this.onAnimationFrame)}},{key:"onClickNext",value:function(){this.setState({mode:(this.state.mode+1)%this.state.modes.length})}},{key:"onClickPrevious",value:function(){this.setState({mode:(this.state.mode+this.state.modes.length-1)%this.state.modes.length})}},{key:"onChange",value:function(e,t){t!==e.value&&this.setOption(e,t)}},{key:"setOption",value:function(e,t){if(e.value=t,e.id){var n=Object.assign({},this.state.mapOptions);n[e.id]=t,this.setState({mapOptions:n})}}},{key:"updateMap",value:function(){var e=k(this.state.mapOptions),t=function(e){for(var t=e.width,n=e.height,a=e.data,o=[],r=0;r<n;r++)o.push(new Array(t).fill(0));if(0===e.rooms.length)return{x:1,y:1};var i=e.rooms[0],h=Math.floor(i.x+i.width/2),l=Math.floor(i.y+i.height/2),s=1,c=[];for(c.push({x:h,y:l});c.length>0;)for(var m=c.length,u=0;u<m;u++){var d=c.shift();s=a[d.y][d.x];for(var f=0;f<4;f++){var v=w[f];d.x+v.x<0||d.x+v.x>t-1||d.y+v.y<0||d.y+v.y>n-1||0!==a[d.y+v.y][d.x+v.x]&&0===o[d.y+v.y][d.x+v.x]&&(o[d.y+v.y][d.x+v.x]=1,c.push({x:d.x+v.x,y:d.y+v.y}))}}var y=e.rooms[s-1];return{x:h=Math.floor(y.x+y.width/2),y:l=Math.floor(y.y+y.height/2)}}(e);this.setState({map:e,player:t})}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{id:"screen"},o.a.createElement("canvas",{id:"canvas",ref:function(t){return e.canvas=t},onClick:this.onClick}),o.a.createElement(p,{show:this.state.showControls,title:this.state.modes[this.state.mode],options:this.state.options[this.state.mode],onClickPrevious:this.onClickPrevious,onClickNext:this.onClickNext,onChange:this.onChange}))}}]),t}(o.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(R,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},9:function(e,t,n){e.exports=n(15)}},[[9,1,2]]]);
//# sourceMappingURL=main.4d3113bf.chunk.js.map