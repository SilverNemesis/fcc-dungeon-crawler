(this["webpackJsonpfcc-dungeon-crawler"]=this["webpackJsonpfcc-dungeon-crawler"]||[]).push([[0],{14:function(t,e,r){},15:function(t,e,r){"use strict";r.r(e);var n=r(1),i=r.n(n),a=r(3),o=r.n(a),h=(r(14),r(4)),s=r(5),f=r(7),l=r(6),u=r(0),c=r(8),y=[{x:0,y:-1},{x:1,y:0},{x:0,y:1},{x:-1,y:0}];function d(t,e){for(var r=[],n=0;n<e;n++)r.push(new Array(t).fill(0));var i={width:t,height:e,data:r};return function(t){for(var e=t.width,r=t.height,n=g(Math.max(Math.floor(Math.min(e/4,r/4)),3)),i=[],a=0,o=n;o>=3;o-=2)for(var h=Math.pow(2,a++),s=0;s<h;s++)i.push(o);var f=[],l=e*r/2,u=0;for(;u<l;){var c=w(i),y={width:c,height:c};Math.random()>.3&&(Math.random()<.5?y.width+=2:y.height+=2),f.push(y),u+=y.width*y.height}t.rooms=f}(i),function(t){var e=t.width,r=t.height,n=t.rooms;!function(t){t.sort((function(t,e){var r=t.width*t.height,n=e.width*e.height;return r<n?1:r>n?-1:0}))}(n);for(var i=n.length,a=0;a<i;a++){for(var o=n[a],h=!1,s=0;s<1e3;s++){o.x=g(v(1,e-o.width-1)),o.y=g(v(1,r-o.height-1));for(var f=!1,l=0;l<a;l++)if(m(o,n[l],o.width>=7?3:1,o.height>=7?3:1)){f=!0;break}if(!f){h=!0;break}}h||(delete o.x,delete o.y)}t.rooms=n.filter((function(t){return t.x||t.y}))}(i),function(t){for(var e=t.width,r=t.height,n=t.data,i=t.rooms,a=i.length,o=0;o<a;o++)for(var h=i[o],s=0;s<h.height;s++)for(var f=0;f<h.width;f++)n[h.y+s][h.x+f]=o+1;for(var l=[],u=0;u<=a;u++)l.push(u);for(var c=[],y=1;y<r-1;y++)for(var d=1;d<e-1;d++)0===n[y][d]&&(0===n[y-1][d]&&0===n[y+1][d]&&0!==n[y][d-1]&&0!==n[y][d+1]?n[y][d-1]<n[y][d+1]?c.push({x:d,y:y,r1:n[y][d-1],r2:n[y][d+1]}):n[y][d-1]>n[y][d+1]&&c.push({x:d,y:y,r1:n[y][d+1],r2:n[y][d-1]}):0===n[y][d-1]&&0===n[y][d+1]&&0!==n[y-1][d]&&0!==n[y+1][d]&&(n[y-1][d]<n[y+1][d]?c.push({x:d,y:y,r1:n[y-1][d],r2:n[y+1][d]}):n[y-1][d]>n[y+1][d]&&c.push({x:d,y:y,r1:n[y+1][d],r2:n[y-1][d]})));v=c,v.sort((function(t,e){return t.r1<e.r1?-1:t.r1>e.r1?1:t.r2<e.r2?-1:t.r2>e.r2?1:t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:0}));var v;var g,w,m=c.length;for(g=0;g<m;g=w){for(w=g+1;w<m&&(c[w].r1===c[g].r1&&c[w].r2===c[g].r2);w++);if(l[c[g].r1]!==l[c[g].r2]){var x=c[Math.floor(g+(w-g)/2)],p=Math.min(l[x.r1],l[x.r2]),F=Math.max(l[x.r1],l[x.r2]);l[x.r1]=p,l[x.r2]=p;for(var k=1;k<=a;k++)l[k]===F&&(l[k]=p);n[x.y][x.x]=a+1}}for(var M=0;M<a;M++){var b=i[M];b.id=M+1,b.group=l[b.id]}}(i),function(t){var e=t.data,r=t.rooms,n=r.length;!function(t){t.sort((function(t,e){return t.group<e.group?-1:t.group>e.group?1:t.id<e.id?-1:t.id>e.id?1:0}))}(r);var i,a,o=0;for(i=0;i<n;i=a){for(a=i+1;a<n&&r[a].group===r[i].group;a++);o++;for(var h=i;h<a;h++)r[h].group=o}for(var s={},f=0;f<n;f++)for(var l=f+1;l<n;l++)if(r[f].group!==r[l].group){var u=x(r[f],r[l]);if(u){var c=u.alignment,y=u.distance,d=u.x,v=u.y,g=u.horizontal;if(0!==c){var w=r[f].group,m=r[l].group,p=w+"_"+m;s[p]?(s[p].distance>y||s[p].distance===y&&s[p].alignment<u)&&(s[p]={distance:y,g1:w,g2:m,room1:r[f].id,room2:r[l].id,alignment:c,x:d,y:v,horizontal:g}):s[p]={distance:y,g1:w,g2:m,room1:r[f].id,room2:r[l].id,alignment:c,x:d,y:v,horizontal:g}}}}var F=[];for(var k in s)s.hasOwnProperty(k)&&F.push(s[k]);M=F,M.sort((function(t,e){return t.distance<e.distance?-1:t.distance>e.distance?1:t.alignment<e.alignment?-1:t.alignment>e.alignment?1:0}));var M;for(var b=[],z=0;z<=o;z++)b.push(z);for(var A=0;A<F.length;A++){var K=F[A];if(b[K.g1]!==b[K.g2]){var O=Math.min(b[K.g1],b[K.g2]),S=Math.max(b[K.g1],b[K.g2]);b[K.g1]=O,b[K.g2]=O;for(var j=1;j<=o;j++)b[j]===S&&(b[j]=O);var E=K.x,D=K.y,R=K.distance;if(K.horizontal)for(var _=0;_<R;_++)e[D][E+_]=n+1;else for(var C=0;C<R;C++)e[D+C][E]=n+1}}(function(t){t.sort((function(t,e){return t.id<e.id?-1:t.id>e.id?1:0}))})(r),t.connected=!0;for(var L=1;L<=o;L++)if(1!==b[L]){t.connected=!1;break}}(i),i}function v(t,e){return Math.floor(Math.random()*(e-t+1))+t}function g(t){return 2*Math.floor(t/2)+1}function w(t){return t[Math.floor(Math.random()*t.length)]}function m(t,e,r,n){return!(t.x>=e.x+e.width+r||e.x>=t.x+t.width+r)&&!(t.y>=e.y+e.height+n||e.y>=t.y+t.height+n)}function x(t,e){if(t.y>e.y+e.height||e.y>t.y+t.height){if(t.x>e.x+e.width||e.x>t.x+t.width)return null;var r,n;t.y>e.y+e.height?(r=e.y+e.height,n=t.y-r):(r=t.y+t.height,n=e.y-r);var i=Math.min(t.x+t.width,e.x+e.width),a=Math.max(t.x,e.x);return{alignment:i-a,distance:n,x:Math.floor((a+i)/2),y:r,horizontal:!1}}if(t.x>e.x+e.width||e.x>t.x+t.width){var o,h;t.x>e.x+e.width?(o=e.x+e.width,h=t.x-o):(o=t.x+t.width,h=e.x-o);var s=Math.min(t.y+t.height,e.y+e.height),f=Math.max(t.y,e.y);return{alignment:s-f,distance:h,x:o,y:Math.floor((f+s)/2),horizontal:!0}}return null}var p=function(t){function e(t){var r;return Object(h.a)(this,e),(r=Object(f.a)(this,Object(l.a)(e).call(this,t))).onResize=r.onResize.bind(Object(u.a)(r)),r.onKeyDown=r.onKeyDown.bind(Object(u.a)(r)),r.onKeyUp=r.onKeyUp.bind(Object(u.a)(r)),r.onAnimationFrame=r.onAnimationFrame.bind(Object(u.a)(r)),r.onClick=r.onClick.bind(Object(u.a)(r)),r.keys={},r}return Object(c.a)(e,t),Object(s.a)(e,[{key:"componentDidMount",value:function(){this._resizeViewport(),this._updateMap(),window.addEventListener("resize",this.onResize),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.frame=window.requestAnimationFrame(this.onAnimationFrame)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.onResize),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp),window.cancelAnimationFrame(this.frame)}},{key:"onResize",value:function(){this._resizeViewport()}},{key:"onKeyDown",value:function(t){t.preventDefault(),this.keys[t.key]||(this.onKeyPress(t.key),this.keys[t.key]=!0,this.captureKeys&&this.state.scene.keyboardState(this.keys))}},{key:"onKeyUp",value:function(t){t.preventDefault(),this.keys[t.key]=!1,this.captureKeys&&this.state.scene.keyboardState(this.keys)}},{key:"onKeyPress",value:function(t){var e=this.state,r=e.map,n=e.player,i=0,a=0;"ArrowUp"===t?a=-1:"ArrowDown"===t?a=1:"ArrowLeft"===t?i=-1:"ArrowRight"===t&&(i=1),0===i&&0===a||0!==r.data[n.y+a][n.x+i]&&this.setState({player:{x:n.x+i,y:n.y+a}})}},{key:"onAnimationFrame",value:function(){this._drawMap(),this.frame=window.requestAnimationFrame(this.onAnimationFrame)}},{key:"onClick",value:function(){this._updateMap()}},{key:"_resizeViewport",value:function(){var t=this.canvas,e=t.getBoundingClientRect();t.width=e.width,t.height=e.height}},{key:"_updateMap",value:function(){for(var t=d(53,27);t.rooms.length<25;)t=d(53,27);var e=function(t){for(var e=t.width,r=t.height,n=t.data,i=[],a=0;a<r;a++)i.push(new Array(e).fill(0));var o=t.rooms[0],h=Math.floor(o.x+o.width/2),s=Math.floor(o.y+o.height/2),f=1,l=[];for(l.push({x:h,y:s});l.length>0;)for(var u=l.length,c=0;c<u;c++){var d=l.shift();f=n[d.y][d.x];for(var v=0;v<4;v++){var g=y[v];d.x+g.x<0||d.x+g.x>e-1||d.y+g.y<0||d.y+g.y>r-1||0!==n[d.y+g.y][d.x+g.x]&&0===i[d.y+g.y][d.x+g.x]&&(i[d.y+g.y][d.x+g.x]=1,l.push({x:d.x+g.x,y:d.y+g.y}))}}var w=t.rooms[f-1];return{x:h=Math.floor(w.x+w.width/2),y:s=Math.floor(w.y+w.height/2)}}(t);this.setState({map:t,player:e})}},{key:"_drawMap",value:function(){if(this.state&&this.state.map){var t=this.state.map,e=t.width,r=t.height,n=t.data,i=t.rooms,a=this.state.player,o=this.canvas.getContext("2d");o.fillStyle="#000000",o.fillRect(0,0,this.canvas.width,this.canvas.height);for(var h=Math.floor(this.canvas.width/e),s=Math.floor(this.canvas.height/r),f=Math.floor((this.canvas.width-e*h)/2),l=Math.floor((this.canvas.height-r*s)/2),u=["#7F0000","#007F00","#00007F","#7F7F00","#7F007F","#007F7F","#7F3F3F","#3F7F3F","#3F3F7F","#7F7F3F","#7F3F7F","#3F7F7F"],c=0;c<r;c++)for(var y=0;y<e;y++)if(0!==n[c][y]){if(n[c][y]<=i.length){var d=i[n[c][y]-1];d.group?o.fillStyle=u[(d.group-1)%u.length]:o.fillStyle="#3F3F3F"}else o.fillStyle="#3F3F3F";o.fillRect(f+y*h+1,l+c*s+1,h-2,s-2),o.fillStyle="#FFFFFF",o.font="8px monospace",o.textAlign="center",o.textBaseline="middle",o.fillText(n[c][y].toString(),f+y*h+h/2,l+c*s+s/2)}o.fillStyle="#7F7FFF",o.beginPath(),o.arc(f+a.x*h+h/2,l+a.y*s+s/2,Math.min(h/4,s/4)-1,0,2*Math.PI),o.fill()}}},{key:"render",value:function(){var t=this;return i.a.createElement("div",{id:"screen"},i.a.createElement("canvas",{id:"canvas",ref:function(e){return t.canvas=e},onClick:this.onClick}))}}]),e}(i.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement(p,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))},9:function(t,e,r){t.exports=r(15)}},[[9,1,2]]]);
//# sourceMappingURL=main.0e03a8dc.chunk.js.map