(this["webpackJsonpfcc-dungeon-crawler"]=this["webpackJsonpfcc-dungeon-crawler"]||[]).push([[0],{14:function(t,e,r){},15:function(t,e,r){"use strict";r.r(e);var i=r(0),n=r.n(i),a=r(3),o=r.n(a),h=(r(14),r(4)),s=r(5),l=r(7),f=r(6),y=r(1),d=r(8),u=[{x:0,y:-1},{x:1,y:0},{x:0,y:1},{x:-1,y:0}];function v(t){for(var e=t.width,r=t.height,i=t.zones,n=t.bossRoom,a=[],o=0;o<r;o++)a.push(new Array(e).fill(0));var h={width:e,height:r,data:a};!function(t,e){var r=t.width,i=t.height,n=e.goal,a=e.minSize,o=e.maxSize;n||(n=.5);a||(a=3);o||(o=g(Math.max(Math.floor(Math.min(r/4,i/4)),a)));for(var h=[],s=0,l=o;l>=a;l-=2)for(var f=Math.pow(2,s++),y=0;y<f;y++)h.push(l);var d=[],u=r*i*n,v=0;for(;v<u;){var c=m(h),w={width:c,height:c};Math.random()>.3&&(Math.random()<.5?w.width+=2:w.height+=2),d.push(w),v+=w.width*w.height}t.rooms=d}(h,t),h.rooms.sort((function(t,e){var r=t.width*t.height,i=e.width*e.height;return r<i?1:r>i?-1:0}));var s=t.maxRooms;if(i&&i>1){if(function(t,e){for(var r=t.width,i=t.height,n=[],a=0;a<e;a++)n[a]=a;!function(t){for(var e=t.length-1;e>0;e--){var r=Math.floor(Math.random()*(e+1)),i=t[e];t[e]=t[r],t[r]=i}}(n);for(var o=Math.floor((r-2)/e),h=Math.floor((i-2)/e),s=[],l=0;l<e;l++){var f={x:l*o+1,y:n[l]*h+1,width:o,height:h};s.push(f)}t.zones=s}(h,i),n){var l=h.rooms[0],f=h.zones[0];l.width<=f.width&&l.height<=f.height&&(l.x=Math.floor(f.x),l.y=Math.floor(f.y+(f.height-l.height)/2))}var y=function(t,e){for(var r=t.width,i=t.height,n=t.rooms,a=t.zones,o=0,h=0,s=n.length,l=0;l<s&&(!e||o!==e);l++){var f=n[l];if(!f.hasOwnProperty("x")||!f.hasOwnProperty("y")){var y=a[h].x,d=Math.min(a[h].x+a[h].width,r-f.width-1),u=a[h].y,v=Math.min(a[h].y+a[h].height,i-f.height-1);if(!(y+f.width>r-1||u+f.height>i-1)){for(var m=!1,x=0;x<100;x++){f.x=g(c(y,d)),f.y=g(c(u,v));for(var p=!1,F=0;F<s;F++)if(F!==l&&n[F].hasOwnProperty("x")&&n[F].hasOwnProperty("y")&&w(f,n[F],1,1)){p=!0;break}if(!p){m=!0;break}}m?(o++,h=(h+1)%a.length):(delete f.x,delete f.y)}}}return o}(h,s);void 0!==s&&(s-=y)}else if(n){var d=h.rooms[0];d.width<=e-2&&d.height<=r-2&&(d.x=Math.floor((e-d.width)/2),d.y=Math.floor((r-d.height)/2))}return function(t,e){for(var r=t.width,i=t.height,n=t.rooms,a=0,o=n.length,h=0;h<o&&(void 0===e||a!==e);h++){var s=n[h];if(!s.hasOwnProperty("x")||!s.hasOwnProperty("y")){for(var l=!1,f=0;f<1e3;f++){s.x=g(c(1,r-s.width-1)),s.y=g(c(1,i-s.height-1));for(var y=!1,d=0;d<o;d++)if(d!==h&&n[d].hasOwnProperty("x")&&n[d].hasOwnProperty("y")&&w(s,n[d],s.width>=7?3:1,s.height>=7?3:1)){y=!0;break}if(!y){l=!0;break}}l?a++:(delete s.x,delete s.y)}}t.rooms=t.rooms.filter((function(t){return t.x||t.y})),t.rooms.length}(h,s),function(t){for(var e=t.width,r=t.height,i=t.data,n=t.rooms,a=n.length,o=0;o<a;o++){var h=n[o];h.id=o+1;for(var s=0;s<h.height;s++)for(var l=0;l<h.width;l++)i[h.y+s][h.x+l]=h.id}for(var f=[],y=0;y<=a;y++)f.push(y);for(var d=[],u=1;u<r-1;u++)for(var v=1;v<e-1;v++)0===i[u][v]&&(0===i[u-1][v]&&0===i[u+1][v]&&0!==i[u][v-1]&&0!==i[u][v+1]?i[u][v-1]<i[u][v+1]?d.push({x:v,y:u,r1:i[u][v-1],r2:i[u][v+1]}):i[u][v-1]>i[u][v+1]&&d.push({x:v,y:u,r1:i[u][v+1],r2:i[u][v-1]}):0===i[u][v-1]&&0===i[u][v+1]&&0!==i[u-1][v]&&0!==i[u+1][v]&&(i[u-1][v]<i[u+1][v]?d.push({x:v,y:u,r1:i[u-1][v],r2:i[u+1][v]}):i[u-1][v]>i[u+1][v]&&d.push({x:v,y:u,r1:i[u+1][v],r2:i[u-1][v]})));c=d,c.sort((function(t,e){return t.r1<e.r1?-1:t.r1>e.r1?1:t.r2<e.r2?-1:t.r2>e.r2?1:t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:0}));var c;var g,m,w=d.length;for(g=0;g<w;g=m){for(m=g+1;m<w&&(d[m].r1===d[g].r1&&d[m].r2===d[g].r2);m++);if(f[d[g].r1]!==f[d[g].r2]){var x=d[Math.floor(g+(m-g)/2)],p=Math.min(f[x.r1],f[x.r2]),F=Math.max(f[x.r1],f[x.r2]);f[x.r1]=p,f[x.r2]=p;for(var M=1;M<=a;M++)f[M]===F&&(f[M]=p);i[x.y][x.x]=a+1}}for(var k=0;k<a;k++){var z=n[k];z.group=f[z.id]}}(h),function(t){var e=t.data,r=t.rooms,i=r.length;!function(t){t.sort((function(t,e){return t.group<e.group?-1:t.group>e.group?1:t.id<e.id?-1:t.id>e.id?1:0}))}(r);var n,a,o=0;for(n=0;n<i;n=a){for(a=n+1;a<i&&r[a].group===r[n].group;a++);o++;for(var h=n;h<a;h++)r[h].group=o}for(var s={},l=0;l<i;l++)for(var f=l+1;f<i;f++)if(r[l].group!==r[f].group){var y=x(r[l],r[f]);if(y){var d=y.alignment,u=y.distance,v=y.x,c=y.y,g=y.horizontal;if(0!==d){var m=r[l].group,w=r[f].group,p=m+"_"+w;s[p]?(s[p].distance>u||s[p].distance===u&&s[p].alignment<y)&&(s[p]={distance:u,g1:m,g2:w,room1:r[l].id,room2:r[f].id,alignment:d,x:v,y:c,horizontal:g}):s[p]={distance:u,g1:m,g2:w,room1:r[l].id,room2:r[f].id,alignment:d,x:v,y:c,horizontal:g}}}}var F=[];for(var M in s)s.hasOwnProperty(M)&&F.push(s[M]);k=F,k.sort((function(t,e){return t.distance<e.distance?-1:t.distance>e.distance?1:t.alignment<e.alignment?-1:t.alignment>e.alignment?1:0}));var k;for(var z=[],O=0;O<=o;O++)z.push(O);for(var b=0;b<F.length;b++){var S=F[b];if(z[S.g1]!==z[S.g2]){var A=Math.min(z[S.g1],z[S.g2]),E=Math.max(z[S.g1],z[S.g2]);z[S.g1]=A,z[S.g2]=A;for(var K=1;K<=o;K++)z[K]===E&&(z[K]=A);var P=S.x,R=S.y,j=S.distance;if(S.horizontal)for(var D=0;D<j;D++)e[R][P+D]=i+1;else for(var _=0;_<j;_++)e[R+_][P]=i+1}}t.connected=!0;for(var C=1;C<=o;C++)if(1!==z[C]){t.connected=!1;break}}(h),function(t){t.sort((function(t,e){return t.id<e.id?-1:t.id>e.id?1:0}))}(h.rooms),h}function c(t,e){return Math.floor(Math.random()*(e-t+1))+t}function g(t){return 2*Math.floor(t/2)+1}function m(t){return t[Math.floor(Math.random()*t.length)]}function w(t,e,r,i){return!(t.x>=e.x+e.width+r||e.x>=t.x+t.width+r)&&!(t.y>=e.y+e.height+i||e.y>=t.y+t.height+i)}function x(t,e){if(t.y>e.y+e.height||e.y>t.y+t.height){if(t.x>e.x+e.width||e.x>t.x+t.width)return null;var r,i;t.y>e.y+e.height?(r=e.y+e.height,i=t.y-r):(r=t.y+t.height,i=e.y-r);var n=Math.min(t.x+t.width,e.x+e.width),a=Math.max(t.x,e.x);return{alignment:n-a,distance:i,x:Math.floor((a+n)/2),y:r,horizontal:!1}}if(t.x>e.x+e.width||e.x>t.x+t.width){var o,h;t.x>e.x+e.width?(o=e.x+e.width,h=t.x-o):(o=t.x+t.width,h=e.x-o);var s=Math.min(t.y+t.height,e.y+e.height),l=Math.max(t.y,e.y);return{alignment:s-l,distance:h,x:o,y:Math.floor((l+s)/2),horizontal:!0}}return null}var p=function(t){function e(t){var r;return Object(h.a)(this,e),(r=Object(l.a)(this,Object(f.a)(e).call(this,t))).onResize=r.onResize.bind(Object(y.a)(r)),r.onKeyDown=r.onKeyDown.bind(Object(y.a)(r)),r.onKeyUp=r.onKeyUp.bind(Object(y.a)(r)),r.onAnimationFrame=r.onAnimationFrame.bind(Object(y.a)(r)),r.onClick=r.onClick.bind(Object(y.a)(r)),r.keys={},r.state={showOverlay:!1},r}return Object(d.a)(e,t),Object(s.a)(e,[{key:"componentDidMount",value:function(){this._resizeViewport(),this._updateMap(),window.addEventListener("resize",this.onResize),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.frame=window.requestAnimationFrame(this.onAnimationFrame)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.onResize),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp),window.cancelAnimationFrame(this.frame)}},{key:"onResize",value:function(){this._resizeViewport()}},{key:"onKeyDown",value:function(t){t.preventDefault(),this.keys[t.key]||(this.onKeyPress(t.key),this.keys[t.key]=!0,this.captureKeys&&this.state.scene.keyboardState(this.keys))}},{key:"onKeyUp",value:function(t){t.preventDefault(),this.keys[t.key]=!1,this.captureKeys&&this.state.scene.keyboardState(this.keys)}},{key:"onKeyPress",value:function(t){var e=this.state,r=e.map,i=e.player;"Escape"===t&&this.setState({showOverlay:!this.state.showOverlay});var n=0,a=0;"ArrowUp"===t?a=-1:"ArrowDown"===t?a=1:"ArrowLeft"===t?n=-1:"ArrowRight"===t&&(n=1),0===n&&0===a||0!==r.data[i.y+a][i.x+n]&&this.setState({player:{x:i.x+n,y:i.y+a}})}},{key:"onAnimationFrame",value:function(){this._drawMap(),this.frame=window.requestAnimationFrame(this.onAnimationFrame)}},{key:"onClick",value:function(){this._updateMap()}},{key:"_resizeViewport",value:function(){var t=this.canvas,e=t.getBoundingClientRect();t.width=e.width,t.height=e.height}},{key:"_updateMap",value:function(){var t=v({width:107,height:55,goal:.25,zones:20,minSize:3,maxSize:7}),e=function(t){for(var e=t.width,r=t.height,i=t.data,n=[],a=0;a<r;a++)n.push(new Array(e).fill(0));if(0===t.rooms.length)return{x:1,y:1};var o=t.rooms[0],h=Math.floor(o.x+o.width/2),s=Math.floor(o.y+o.height/2),l=1,f=[];for(f.push({x:h,y:s});f.length>0;)for(var y=f.length,d=0;d<y;d++){var v=f.shift();l=i[v.y][v.x];for(var c=0;c<4;c++){var g=u[c];v.x+g.x<0||v.x+g.x>e-1||v.y+g.y<0||v.y+g.y>r-1||0!==i[v.y+g.y][v.x+g.x]&&0===n[v.y+g.y][v.x+g.x]&&(n[v.y+g.y][v.x+g.x]=1,f.push({x:v.x+g.x,y:v.y+g.y}))}}var m=t.rooms[l-1];return{x:h=Math.floor(m.x+m.width/2),y:s=Math.floor(m.y+m.height/2)}}(t);this.setState({map:t,player:e})}},{key:"_drawMap",value:function(){if(this.state&&this.state.map){var t=this.state.map,e=t.width,r=t.height,i=t.data,n=t.rooms,a=this.state.player,o=this.canvas.getContext("2d");o.fillStyle="#000000",o.fillRect(0,0,this.canvas.width,this.canvas.height);for(var h=Math.floor(this.canvas.width/e),s=Math.floor(this.canvas.height/r),l=Math.floor((this.canvas.width-e*h)/2),f=Math.floor((this.canvas.height-r*s)/2),y=["#7F0000","#007F00","#00007F","#7F7F00","#7F007F","#007F7F","#7F3F3F","#3F7F3F","#3F3F7F","#7F7F3F","#7F3F7F","#3F7F7F"],d=0;d<r;d++)for(var u=0;u<e;u++)if(0!==i[d][u]){if(i[d][u]<=n.length){var v=n[i[d][u]-1];v.group?o.fillStyle=y[(v.group-1)%y.length]:o.fillStyle="#3F3F3F"}else o.fillStyle="#3F3F3F";o.fillRect(l+u*h+1,f+d*s+1,h-2,s-2),o.fillStyle="#FFFFFF",o.font="8px monospace",o.textAlign="center",o.textBaseline="middle",o.fillText(i[d][u].toString(),l+u*h+h/2,f+d*s+s/2)}var c=Math.floor(n[0].x+n[0].width/2),g=Math.floor(n[0].y+n[0].height/2);o.fillStyle="#FFFFFF",o.font="50px monospace",o.textAlign="center",o.textBaseline="middle",o.fillText("O",l+c*h+h/2,f+g*s+s/2),o.fillStyle="#FFFFFF",o.font="50px monospace",o.textAlign="center",o.textBaseline="middle",o.fillText("X",l+a.x*h+h/2,f+a.y*s+s/2)}}},{key:"render",value:function(){var t=this,e=null;this.state&&this.state.map&&this.state.map.zones&&(e=this.state.map.zones.map((function(t,e){return n.a.createElement("div",{key:e},JSON.stringify(t,null,2))})));var r=null;return this.state&&this.state.map&&this.state.map.rooms&&(r=this.state.map.rooms.map((function(t,e){return n.a.createElement("div",{key:e},JSON.stringify(t,null,2))}))),n.a.createElement("div",{id:"screen"},n.a.createElement("canvas",{id:"canvas",ref:function(e){return t.canvas=e},onClick:this.onClick}),n.a.createElement("div",{id:"overlay",hidden:!this.state.showOverlay},e,r))}}]),e}(n.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(n.a.createElement(p,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))},9:function(t,e,r){t.exports=r(15)}},[[9,1,2]]]);
//# sourceMappingURL=main.e29b8e49.chunk.js.map